<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-development/plugin/metric-develop">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Metric Develop Guide | Datavines</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://datavines.io/datavines-website/en/docs/development/plugin/metric-develop"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Metric Develop Guide | Datavines"><meta data-rh="true" name="description" content="Metric 是 Datavines 中一个核心概念，一个 Metric 表示一个数据质量检查规则，比如空值检查和表行数检查都是一个规则。Metric 采用插件化设计，用户可以根据自己的需求来实现一个 Metric。下面我们来详细讲解一下如何自定义Metric。"><meta data-rh="true" property="og:description" content="Metric 是 Datavines 中一个核心概念，一个 Metric 表示一个数据质量检查规则，比如空值检查和表行数检查都是一个规则。Metric 采用插件化设计，用户可以根据自己的需求来实现一个 Metric。下面我们来详细讲解一下如何自定义Metric。"><link data-rh="true" rel="icon" href="/datavines-website/en/image/favicon.ico"><link data-rh="true" rel="canonical" href="https://datavines.io/datavines-website/en/docs/development/plugin/metric-develop"><link data-rh="true" rel="alternate" href="https://datavines.io/datavines-website/en/docs/development/plugin/metric-develop" hreflang="en"><link data-rh="true" rel="alternate" href="https://datavines.io/datavines-website/docs/development/plugin/metric-develop" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://datavines.io/datavines-website/docs/development/plugin/metric-develop" hreflang="x-default"><link rel="stylesheet" href="/datavines-website/en/assets/css/styles.460c41f1.css">
<link rel="preload" href="/datavines-website/en/assets/js/runtime~main.fc868880.js" as="script">
<link rel="preload" href="/datavines-website/en/assets/js/main.4a0f68cc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/datavines-website/en/"><div class="navbar__logo"><img src="/datavines-website/en/image/logo.png" alt="Datavines Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/datavines-website/en/image/logo.png" alt="Datavines Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Datavines</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/datavines-website/en/docs/intro">Document</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/datavines-website/en/community/contribution_guide/code-conduct">Code of conduct</a></li><li><a class="dropdown__link" href="/datavines-website/en/community/contribution_guide/contributor">Contributor</a></li><li><a class="dropdown__link" href="/datavines-website/en/community/contribution_guide/pull-request">Pull Request Notice</a></li></ul></div><a class="navbar__item navbar__link" href="/datavines-website/en/docs/roadmap">Roadmap</a><a class="navbar__item navbar__link" href="/datavines-website/en/docs/faq">FAQ</a><a href="https://github.com/datavane/datavines" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/datavines-website/en/docs/development/plugin/metric-develop" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/datavines-website/docs/development/plugin/metric-develop" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-CN">简体中文</a></li></ul></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/datavines-website/en/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/datavines-website/en/docs/get-started/deploy-from-source">Get Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/get-started/deploy-from-source">Deploy From Source</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/datavines-website/en/docs/user-guide/quick-start">User Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/user-guide/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/user-guide/local-mode">Local Mode</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/datavines-website/en/docs/features/catalog/catalog-intro">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/catalog/catalog-intro">Catalog</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/catalog-intro">Catalog Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-mysql">Catalog Connector</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-mysql">MySQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-doris">Doris</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-starrocks">StarRocks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-hive">Hive</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-postgresql">PostgreSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-clickhouse">ClickHouse</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-trino">Trino</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-presto">Presto</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-impala">Impala</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/catalog/connector/connector-databend">Databend</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/custom-aggregate-sql">Data Quality Metric</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/custom-aggregate-sql">Single Table Metric</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/custom-aggregate-sql">custom_aggregate_sql</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-not-null">column_not_null</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-null">column_null</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-avg">column_avg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-avg-length">column_avg_length</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-blank">column_blank</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-distinct">column_distinct</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-duplicate">column_duplicate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-in-enums">column_in_enums</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-not-in-enums">column_not_in_enums</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-length">column_length</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-match-not-regex">column_match_not_regex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-match-regex">column_match_regex</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-max">column_max</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-max-length">column_max_length</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-min">column_min</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-min-length">column_min_length</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-std-dev">column_std_dev</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-sum">column_sum</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-unique">column_unique</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-value-between">column_value_between</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-variance">column_variance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/column-freshness">column_freshness</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/single-table-metric/table-row-count">table_row_count</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/metric/multi-table-metric/multi-table-value-comparison">Multi Table Metric</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/multi-table-metric/multi-table-value-comparison">multi_table_value_comparison</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/multi-table-metric/multi-table-accuracy">multi_table_accuracy</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-none">Expected Value</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-none">none</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-fix-value">fix_value</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-daily-avg">daily_avg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-weekly-avg">weekly_avg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-monthly-avg">monthly_avg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-last7day-avg">last7day_avg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-last30day-avg">last30day_avg</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-table-rows">table_rows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/expected-value/expected-value-target-table-rows">target_table_rows</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/metric/result-validate-formula/formula-intro">Result Validate Formula</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/result-validate-formula/formula-intro">Formula Intro</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/result-validate-formula/formula-count">count</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/result-validate-formula/formula-diff">diff</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/result-validate-formula/formula-diff-actual-expected">diff_actual_expected</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/result-validate-formula/formula-diff-percentage">diff_percentage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/metric/result-validate-formula/formula-percentage">percentage</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/features/engine/local-engine">Engine</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/engine/local-engine">Local Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/engine/spark-engine">Spark Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/engine/livy-engine">Livy Engine</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/slas">SLAs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/error-data-storage">Error Data Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/issues">Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/tag">Tag</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/config">Global Config</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/features/time-variable">Time Variable</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/datavines-website/en/docs/integration/dolphin-scheduler">Integration</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/integration/dolphin-scheduler">DolphinScheduler</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/datavines-website/en/docs/development/architecture-design">Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/development/architecture-design">Architecture Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/development/environment-preparation">Environment Preparation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/development/source-module-explanation">Source Module Explanation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/datavines-website/en/docs/development/plugin/metric-develop">Plugin Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/datavines-website/en/docs/development/plugin/metric-develop">Metric Develop Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/development/plugin/connector-develop">Connector Develop Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/development/plugin/engine-develop">Engine Develop Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/development/plugin/notification-develop">Notification Develop Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/datavines-website/en/docs/development/plugin/registry-develop">Registry Develop Guide</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/datavines-website/en/docs/roadmap">Roadmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/datavines-website/en/docs/faq">FAQ</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/datavines-website/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Plugin Development</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Metric Develop Guide</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Metric Develop Guide</h1></header><p>Metric 是 Datavines 中一个核心概念，一个 Metric 表示一个数据质量检查规则，比如空值检查和表行数检查都是一个规则。Metric 采用插件化设计，用户可以根据自己的需求来实现一个 Metric。下面我们来详细讲解一下如何自定义<code>Metric</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第一步">第一步<a href="#第一步" class="hash-link" aria-label="Direct link to 第一步" title="Direct link to 第一步">​</a></h3><p>我们先了解下几个接口和抽象类，它们是实现自定义 Metric 的关键。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="sqlmetric-接口">SqlMetric 接口<a href="#sqlmetric-接口" class="hash-link" aria-label="Direct link to SqlMetric 接口" title="Direct link to SqlMetric 接口">​</a></h4><p><code>SqlMetric</code>接口中定义了规则的各种属性和操作的接口。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">@SPI</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">public interface SqlMetric {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 中文名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    String getName();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 英文名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    String getZhName();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 根据系统的语言进行名字返回</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default String getNameByLanguage(boolean isEn) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return isEn ? getName() : getZhName();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 规则属于哪个维度，比如准确性、唯一性等等</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    MetricDimension getDimension();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 规则的类型，包括单表检查、单表自定义检查</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    MetricType getType();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 规则的级别，比如表级别、列级别</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default MetricLevel getLevel() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return MetricLevel.NONE;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 是否支持错误数据输出</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    boolean isInvalidateItemsCanOutput();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * 获取不符合规则的数据的SQL语句</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * @return ExecuteSql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ExecuteSql getInvalidateItems(String uniqueKey);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * 计算实际值的SQL语句</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * @return ExecuteSql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    ExecuteSql getActualValue(String uniqueKey);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    /**</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     * 实际值的字段名</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     */</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default String getActualName() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return &quot;actual_value&quot;;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 实际值的类型，比如数字，百分比或者列表</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default String getActualValueType() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return MetricActualValueType.COUNT.getDescription();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 对参数进行检查并输出检查结果</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    CheckResult validateConfig(Map&lt;String,Object&gt; config);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    //规则所需要的参数</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    Map&lt;String, ConfigItem&gt; getConfigMap();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    //构造规则前需要做的检查</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    void prepare(Map&lt;String,String&gt; config);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default String getIssue() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return &quot;&quot;;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 适合哪些字段类型</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    List&lt;DataVinesDataType&gt; suitableType();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 是否支持多选，比如表行数检查支持多张表</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default boolean supportMultiple() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 对规则参数的重新构造，配合表行数多张表检查</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    default List&lt;Map&lt;String,Object&gt;&gt; getMetricParameter(Map&lt;String,Object&gt; metricParameter) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return Collections.singletonList(metricParameter);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="basesingletable-抽象类">BaseSingleTable 抽象类<a href="#basesingletable-抽象类" class="hash-link" aria-label="Direct link to BaseSingleTable 抽象类" title="Direct link to BaseSingleTable 抽象类">​</a></h4><p><code>BaseSingleTable</code>是实现了 SqlMetric 接口的抽象类，实现了表级别检查规则中所需要参数的添加、错误数据SQL语句构造和实际值计算SQL语句构造和对过滤条件的处理等。</p><ul><li>这里定义了获取不符合规则的数据的基础SQL语句，判断类型的规则比如正则表达式检查和枚举值检查，只需要在基础SQL语句后面添加过滤条件即可。</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">    protected StringBuilder invalidateItemsSql = new StringBuilder(&quot;select * from ${table}&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>实际值计算SQL语句默认是计算不符合规则数据的行数</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">String actualValueSql = &quot;select count(1) as actual_value_&quot;+ uniqueKey +&quot; from ${invalidate_items_table}&quot;; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>计算平均值、汇总值等统计类型的规则需要重新实现<code>getActualValue()</code>中的<code>ExecuteSql</code>。</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">public abstract class BaseSingleTable implements SqlMetric {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    // 这里定义了获取不符合规则的数据的基础 SQL 语句，判断类的规则比如正则表达式和枚举值检查，只需要在基础SQL后面添加过滤条件即可。</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    protected StringBuilder invalidateItemsSql = new StringBuilder(&quot;select * from ${table}&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    protected List&lt;String&gt; filters = new ArrayList&lt;&gt;();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    protected HashMap&lt;String,ConfigItem&gt; configMap = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    protected Set&lt;String&gt; requiredOptions = new HashSet&lt;&gt;();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public BaseSingleTable() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        configMap.put(&quot;table&quot;,new ConfigItem(&quot;table&quot;, &quot;表名&quot;, &quot;table&quot;));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        configMap.put(&quot;filter&quot;,new ConfigItem(&quot;filter&quot;, &quot;过滤条件&quot;, &quot;filter&quot;));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        requiredOptions.add(&quot;table&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public ExecuteSql getInvalidateItems(String uniqueKey) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        ExecuteSql executeSql = new ExecuteSql();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        executeSql.setResultTable(&quot;invalidate_items_&quot; + uniqueKey);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        executeSql.setSql(invalidateItemsSql.toString());</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        executeSql.setErrorOutput(isInvalidateItemsCanOutput());</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return executeSql;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public ExecuteSql getActualValue(String uniqueKey) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        ExecuteSql executeSql = new ExecuteSql();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        executeSql.setResultTable(&quot;invalidate_count_&quot; + uniqueKey);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        String actualValueSql = &quot;select count(1) as actual_value_&quot;+ uniqueKey +&quot; from ${invalidate_items_table}&quot;;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        executeSql.setSql(actualValueSql);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        executeSql.setErrorOutput(false);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return executeSql;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public CheckResult validateConfig(Map&lt;String, Object&gt; config) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return ConfigChecker.checkConfig(config, requiredOptions);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public void prepare(Map&lt;String, String&gt; config) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        if (config.containsKey(&quot;filter&quot;)) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            filters.add(config.get(&quot;filter&quot;));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        addFiltersIntoInvalidateItemsSql();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    private void addFiltersIntoInvalidateItemsSql() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        if (filters.size() &gt; 0) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            invalidateItemsSql.append(&quot; where &quot;).append(String.join(&quot; and &quot;, filters));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public MetricLevel getLevel() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return MetricLevel.TABLE;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="basesingletablecolumn-抽象类">BaseSingleTableColumn 抽象类<a href="#basesingletablecolumn-抽象类" class="hash-link" aria-label="Direct link to BaseSingleTableColumn 抽象类" title="Direct link to BaseSingleTableColumn 抽象类">​</a></h4><p><code>BaseSingleTableColumn</code>是列级别的抽象实现类，主要是添加列级别规则的通用参数。</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">public abstract class BaseSingleTableColumn extends BaseSingleTable {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public BaseSingleTableColumn() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        super();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        configMap.put(&quot;column&quot;,new ConfigItem(&quot;column&quot;, &quot;列名&quot;, &quot;column&quot;));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        requiredOptions.add(&quot;column&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public Map&lt;String, ConfigItem&gt; getConfigMap() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return configMap;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public MetricLevel getLevel() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return MetricLevel.COLUMN;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public boolean isInvalidateItemsCanOutput() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return false;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第二步">第二步<a href="#第二步" class="hash-link" aria-label="Direct link to 第二步" title="Direct link to 第二步">​</a></h3><p>了解完上面的三个基础类以后，自定义一个<code>Metric</code>就变得格外简单了。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="基础工作">基础工作<a href="#基础工作" class="hash-link" aria-label="Direct link to 基础工作" title="Direct link to 基础工作">​</a></h4><p>在 datavines-metric-plugins 下创建一个新规则的 module</p><p><img loading="lazy" src="https://img-blog.csdnimg.cn/96646c5e91f44741a17457b0092a4ba3.jpeg#pic_center" alt="在这里插入图片描述" class="img_ev3q"></p><p>在 pom.xml 中添加</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain"> &lt;dependency&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     &lt;groupId&gt;io.datavines&lt;/groupId&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     &lt;artifactId&gt;datavines-metric-base&lt;/artifactId&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">     &lt;version&gt;${project.version}&lt;/version&gt;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &lt;/dependency&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="以-枚举值检查-规则为例来讲解">以 枚举值检查 规则为例来讲解<a href="#以-枚举值检查-规则为例来讲解" class="hash-link" aria-label="Direct link to 以 枚举值检查 规则为例来讲解" title="Direct link to 以 枚举值检查 规则为例来讲解">​</a></h4><ul><li>判断要实现的规则的级别，因为枚举值检查是列级别，所以继承 BaseSingleTableColumn 即可。</li><li>在构造函数中的<code>configMap</code>添加<code>enum_list</code>参数用于返回给前端进行展示，在<code>requiredOptions</code>添加<code>enum_list</code>用于参数的检查。</li><li>实现英文名、中文名、规则维度、规则类型这些基础的属性。</li><li>因为枚举值检查规则是为了找出在枚举值列表中的数据，所以只需要在<code>fileters</code>这个数组里面加入<code>(${column} in ( ${enum_list} ))</code>，<code>prepare()</code>方法会自动进行不符合规则的SQL语句构造。</li><li>实现<code>suitableType()</code>方法添加规则适用的字段类型。</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">public class ColumnInEnums extends BaseSingleTableColumn {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public ColumnInEnums(){</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        super();</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        configMap.put(&quot;enum_list&quot;,new ConfigItem(&quot;enum_list&quot;, &quot;枚举值列表&quot;, &quot;enum_list&quot;));</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        requiredOptions.add(&quot;enum_list&quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public String getName() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return &quot;column_in_enums&quot;;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public String getZhName() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return &quot;枚举值检查&quot;;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public MetricDimension getDimension() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return MetricDimension.EFFECTIVENESS;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public MetricType getType() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return MetricType.SINGLE_TABLE;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public boolean isInvalidateItemsCanOutput() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return true;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public void prepare(Map&lt;String, String&gt; config) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        if (config.containsKey(&quot;enum_list&quot;) &amp;&amp; config.containsKey(&quot;column&quot;)) {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            filters.add(&quot; (${column} in ( ${enum_list} )) &quot;);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        super.prepare(config);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    @Override</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    public List&lt;DataVinesDataType&gt; suitableType() {</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        return Arrays.asList(DataVinesDataType.NUMERIC_TYPE, DataVinesDataType.STRING_TYPE, DataVinesDataType.DATE_TIME_TYPE);</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第三步">第三步<a href="#第三步" class="hash-link" aria-label="Direct link to 第三步" title="Direct link to 第三步">​</a></h3><p>非常重要的一步</p><ul><li>在 resources 目录下创建<code>META-INF/plugins</code>目录。</li><li>在 plugins 目录下创建文件并且命名为<code>io.datavines.metric.api.SqlMetric</code>。</li><li>在文件中添加<code>column_in_enums=io.datavines.metric.plugin.ColumnInEnums</code>。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="第四步">第四步<a href="#第四步" class="hash-link" aria-label="Direct link to 第四步" title="Direct link to 第四步">​</a></h3><p>打包成<code>jar</code>放到 datavines 目录下的<code>libs</code>目录下，重启服务即可。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/datavane/datavines-website/edit/dev/docs/06-development/04-plugin/01-metric-develop.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/datavines-website/en/docs/development/source-module-explanation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Source Module Explanation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/datavines-website/en/docs/development/plugin/connector-develop"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Connector Develop Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#第一步" class="table-of-contents__link toc-highlight">第一步</a></li><li><a href="#第二步" class="table-of-contents__link toc-highlight">第二步</a></li><li><a href="#第三步" class="table-of-contents__link toc-highlight">第三步</a></li><li><a href="#第四步" class="table-of-contents__link toc-highlight">第四步</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/datavane/datavines" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/datavane/datavines/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">Issue Tracker<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/datavane/datavines/pulls" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pull Requests<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Resource</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/datavines-website/en/docs/intro">Document</a></li><li class="footer__item"><a href="https://github.com/datavane/datavines/releases" target="_blank" rel="noopener noreferrer" class="footer__link-item">Releases<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/datavane/datavines/issues/507" target="_blank" rel="noopener noreferrer" class="footer__link-item">FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                  <div class="footer-left-box">
                    <div class="flex align-center footer-system">
                      <span class="system-title">About Datavines</span>
                    </div>
                    <p>Next-gen Data Observability platform</p>
                  </div></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022-2023 Datavines Community.</div></div></div></footer></div>
<script src="/datavines-website/en/assets/js/runtime~main.fc868880.js"></script>
<script src="/datavines-website/en/assets/js/main.4a0f68cc.js"></script>
</body>
</html>